<app-page-container>
  <h1 class="tui-text_h3">Upload Video</h1>

  <tui-stepper
    [activeItemIndex]="activeIndex"
    (activeItemIndexChange)="onActiveIndexChange($event)"
    style="margin-bottom: 2rem"
  >
    <button tuiStep icon="@tui.upload-cloud" [disabled]="isUploading || isUploadComplete">
      Select Video
    </button>
    <button
      tuiStep
      icon="@tui.file-text"
      [disabled]="!isFilesSelected || isUploading || isUploadComplete"
    >
      Enter Details
    </button>
    <button tuiStep icon="@tui.upload" [disabled]="activeIndex < 2">Upload</button>
  </tui-stepper>

  <div [tuiSlides]="slideDirection" style="overflow: hidden">
    @switch (activeIndex) {
      @case (0) {
        <div>
          <app-video-selector
            [control]="filesControl"
            style="display: block; margin-bottom: 1.5rem"
          />
          <div style="display: flex; justify-content: flex-end">
            <button
              tuiButton
              size="m"
              type="button"
              [disabled]="!isFilesSelected"
              (click)="onNext()"
            >
              Next
            </button>
          </div>
        </div>
      }
      @case (1) {
        <div>
          <app-video-details [form]="detailsForm" style="display: block; margin-bottom: 1.5rem" />

          <tui-textfield
            tuiChevron
            [content]="detailsForm.controls.group.value && content"
            [stringify]="groupStringify"
            style="margin-bottom: 1.5rem"
          >
            <label tuiLabel>Group</label>
            <input
              placeholder="Choose a group"
              tuiSelect
              [formControl]="detailsForm.controls.group"
            />

            <tui-data-list-wrapper
              *tuiTextfieldDropdown
              new
              [itemContent]="content"
              [items]="groups"
            />
          </tui-textfield>

          <ng-template #content let-group>
            <div style="display: flex; align-items: center; gap: 0.5rem">
              <!-- Using a simple img or div if tui-avatar is not behaving inside template context without proper imports or binding issues, but tui-avatar is standard -->
              <tui-avatar
                [src]="group.avatar ? 'data:image/png;base64,' + group.avatar : '@tui.users'"
                size="xs"
              ></tui-avatar>
              {{ group.name }}
            </div>
          </ng-template>

          <div style="display: flex; justify-content: flex-end; gap: 0.5rem">
            <button tuiButton appearance="flat" size="m" type="button" (click)="onBack()">
              Back
            </button>
            <button
              tuiButton
              size="m"
              type="button"
              [disabled]="detailsForm.invalid"
              (click)="onNext()"
            >
              Next
            </button>
          </div>
        </div>
      }
      @case (2) {
        <div>
          <div style="margin-bottom: 2rem">
            <tui-files>
              <tui-file
                *ngFor="let file of uploadingFiles"
                state="loading"
                [file]="file"
              ></tui-file>
              <tui-file *ngFor="let file of completedFiles" state="normal" [file]="file"></tui-file>
              <tui-file *ngFor="let file of failedFiles" state="error" [file]="file"></tui-file>
            </tui-files>
          </div>

          <div style="display: flex; justify-content: flex-end; gap: 0.5rem">
            <button
              tuiButton
              size="m"
              type="button"
              [disabled]="!isUploadComplete"
              (click)="onNext()"
            >
              Finish
            </button>
          </div>
        </div>
      }
    }
  </div>
</app-page-container>
