<app-page-container *ngIf="asset$ | async as asset">
  <div class="header">
    <a tuiButton appearance="flat" iconStart="@tui.arrow-left" routerLink="/">Back</a>

    <h1 class="tui-text_h3 desktop-title">{{ asset.title }}</h1>

    <tui-pagination
      *ngIf="(asset.videos?.length || 0) > 1"
      [length]="asset.videos!.length"
      [index]="videoIndex"
      (indexChange)="onIndexChange($event)"
      class="pagination"
    ></tui-pagination>
    <div *ngIf="(asset.videos?.length || 0) == 1" style="width: 105px"></div>
  </div>

  <div class="content-body">
    <div class="media-content">
      <div class="player-wrapper" *ngIf="getPlaybackId(asset) as pid">
        <mux-player
          [attr.playback-id]="pid"
          [attr.metadata-video-title]="asset.title"
          stream-type="on-demand"
        ></mux-player>
      </div>

      <div *ngIf="!getPlaybackId(asset)" class="tui-space_top-4">
        <p class="tui-text_body-m">Video is processing or not available.</p>
      </div>

      <div class="text-content">
        <h1 class="tui-text_h3 title mobile-title">{{ asset.title }}</h1>
        <p class="description tui-text_body-l">{{ asset.description }}</p>
      </div>

      <div
        *ngIf="canReadReviews()"
        class="comments-section tui-space_top-6"
        style="padding-bottom: 80px"
      >
        <h2 class="tui-text_h3">Comments</h2>

        <div
          class="reviews-list tui-space_top-4"
          style="display: flex; flex-direction: column; gap: 1rem"
        >
          <section *ngFor="let review of reviews$ | async" tuiCardLarge="compact">
            <div class="review-content tui-text_body-m">
              {{ review.content }}
            </div>
          </section>

          <div *ngIf="(reviews$ | async)?.length === 0" class="tui-text_body-m tui-space_bottom-4">
            No comments yet.
          </div>
        </div>
      </div>
    </div>
  </div>
</app-page-container>

<div
  *ngIf="canAddReviews()"
  class="comment-input-container"
  style="
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 800px;
    background: var(--tui-background-base);
    border: 1px solid var(--tui-border-normal);
    border-bottom: none;
    border-radius: var(--tui-radius-l) var(--tui-radius-l) 0 0;
    z-index: 100;
    padding: 1rem;
    display: flex;
    justify-content: center;
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
  "
>
  <div style="width: 100%; display: flex; gap: 1rem; align-items: flex-end">
    <tui-textfield style="flex: 1">
      <textarea
        tuiTextarea
        [formControl]="reviewControl"
        [min]="1"
        [max]="15"
        placeholder="Add a comment..."
      ></textarea>
    </tui-textfield>
    <button
      appearance="primary"
      tuiIconButton
      iconStart="@tui.send-horizontal"
      (click)="postReview()"
      [disabled]="!reviewControl.value"
    ></button>
  </div>
</div>
